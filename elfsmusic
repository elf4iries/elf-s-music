--[[
    YouTube Music Player (Basalt UI)
    Versão com múltiplos métodos de reprodução
]]

-- Verificar Basalt
if not fs.exists("/basalt") then
    print("Instalando Basalt...")
    shell.run("wget", "run", "https://raw.githubusercontent.com/Pyroxenium/Basalt2/main/install.lua")
end

-- Carregar Basalt
local basalt = require("basalt")

-- Criar janela principal
local main = basalt.createFrame()
main:setBackground(colors.black)

-- Título
local title = main:addLabel()
title:setText("YOUTUBE MUSIC PLAYER")
title:setPosition(2, 2)
title:setForeground(colors.white)

-- Campo de URL
local urlLabel = main:addLabel()
urlLabel:setText("URL do YouTube:")
urlLabel:setPosition(2, 4)
urlLabel:setForeground(colors.cyan)

local urlInput = main:addInput()
urlInput:setPosition(2, 5)
urlInput:setSize(35, 1)
urlInput:setBackground(colors.blue)
urlInput:setForeground(colors.white)

-- Botões
local playBtn = main:addButton()
playBtn:setText("TOCAR")
playBtn:setPosition(2, 7)
playBtn:setSize(8, 3)
playBtn:setBackground(colors.green)
playBtn:setForeground(colors.black)

local stopBtn = main:addButton()
stopBtn:setText("PARAR")
stopBtn:setPosition(12, 7)
stopBtn:setSize(8, 3)
stopBtn:setBackground(colors.red)
stopBtn:setForeground(colors.black)

-- Status
local status = main:addLabel()
status:setText("Pronto")
status:setPosition(2, 11)
status:setForeground(colors.lime)

-- Instalar players se necessário
if not fs.exists("music") then
    status:setText("Instalando music player...")
    shell.run("wget", "https://music.madefor.cc/music.lua", "music")
end

if not fs.exists("yt") then
    shell.run("wget", "run", "https://pastebin.com/raw/Xf0HQH0H", "yt")
end

-- Função para tocar música
local function playMusic(url)
    if not url or url == "" then
        status:setText("Digite uma URL")
        return false
    end
    
    status:setText("Tentando reproduzir...")
    
    -- Tenta vários métodos de reprodução
    local methods = {
        {"music", "play"},
        {"yt", "play"},
        {"ccyt", "play"}
    }
    
    for i, method in ipairs(methods) do
        local player, command = method[1], method[2]
        
        if fs.exists(player) then
            status:setText("Usando " .. player .. "...")
            
            local result = shell.run(player, command, url)
            
            if result then
                status:setText("Reproduzindo com " .. player)
                return true
            else
                status:setText(player .. " falhou, tentando próximo...")
            end
        end
    end
    
    -- Se nenhum funcionar, tenta instalar um player novo
    status:setText("Instalando novo player...")
    local installResult = shell.run("wget", "run", "https://pastebin.com/raw/Xf0HQH0H", "yt2")
    
    if installResult and fs.exists("yt2") then
        status:setText("Tentando com yt2...")
        local result = shell.run("yt2", "play", url)
        if result then
            status:setText("Reproduzindo com yt2")
            return true
        end
    end
    
    status:setText("ERRO: Nenhum player funcionou")
    return false
end

-- Função para parar
local function stopMusic()
    -- Para todos os players possíveis
    shell.run("music", "stop")
    shell.run("yt", "stop")
    shell.run("ccyt", "stop")
    status:setText("Parado")
end

-- Eventos dos botões
playBtn:onClick(function()
    local url = urlInput:getValue()
    playMusic(url)
end)

stopBtn:onClick(function()
    stopMusic()
end)

-- Exemplo de URL
local example = main:addLabel()
example:setText("Ex: youtu.be/dQw4w9WgXcQ")
example:setPosition(2, 13)
example:setForeground(colors.gray)

-- Iniciar
basalt.run()
