--[[
    YouTube Music Player (Basalt UI)
]]

local basalt = require("basalt")

local main = basalt.createFrame()
main:setBackground(colors.black)

local title = main:addLabel()
title:setText("YOUTUBE MUSIC PLAYER")
title:setPosition(2, 2)
title:setForeground(colors.white)

local urlLabel = main:addLabel()
urlLabel:setText("URL do YouTube:")
urlLabel:setPosition(2, 4)
urlLabel:setForeground(colors.cyan)

local urlInput = main:addInput()
urlInput:setPosition(2, 5)
urlInput:setSize(35, 1)
urlInput:setBackground(colors.blue)
urlInput:setForeground(colors.white)

local playBtn = main:addButton()
playBtn:setText("TOCAR")
playBtn:setPosition(2, 7)
playBtn:setSize(8, 3)
playBtn:setBackground(colors.green)
playBtn:setForeground(colors.black)

local stopBtn = main:addButton()
stopBtn:setText("PARAR")
stopBtn:setPosition(12, 7)
stopBtn:setSize(8, 3)
stopBtn:setBackground(colors.red)
stopBtn:setForeground(colors.black)

local status = main:addLabel()
status:setText("Pronto")
status:setPosition(2, 11)
status:setForeground(colors.lime)

local function isValidYouTubeURL(url)
    if not url or url == "" then
        return false, "URL vazia"
    end
    
    local patterns = {
        "youtube.com/watch%?v=",
        "youtu.be/",
        "youtube.com/embed/",
        "youtube.com/v/"
    }
    
    for _, pattern in ipairs(patterns) do
        if string.find(url, pattern) then
            return true
        end
    end
    
    return false, "URL do YouTube inválida"
end

local function playMusic(url)
    local valid, errorMsg = isValidYouTubeURL(url)
    if not valid then
        status:setText(errorMsg)
        return false
    end
    
    status:setText("Iniciando reprodução...")
    
    local result = shell.run("music", "play", url)
    
    if result then
        status:setText("Reprodução concluída")
        return true
    else
        status:setText("Erro na reprodução")
        return false
    end
end

local function stopMusic()
    shell.run("music", "stop")
    status:setText("Parado")
end

playBtn:onClick(function()
    local url = urlInput:getValue()
    playMusic(url)
end)

stopBtn:onClick(function()
    stopMusic()
end)

local help = main:addLabel()
help:setText("Exemplo: youtube.com/watch?v=...")
help:setPosition(2, 13)
help:setForeground(colors.gray)

local help2 = main:addLabel()
help2:setText("ou youtu.be/...")
help2:setPosition(2, 14)
help2:setForeground(colors.gray)

basalt.run()
