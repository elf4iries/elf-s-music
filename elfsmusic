local speaker = peripheral.find("speaker")

if not speaker then
    error("Speaker nao encontrado!")
end

local function searchYouTube(query)
    term.clear()
    term.setCursorPos(1, 1)
    print("=== YOUTUBE MUSIC SEARCH ===")
    print()
    print("Buscando: " .. query)
    print()
    
    local url = "https://music.madefor.cc/search?q=" .. textutils.urlEncode(query)
    local response = http.get(url, nil, true)
    
    if not response then
        print("Erro ao conectar!")
        return
    end
    
    local data = response.readAll()
    response.close()
    
    local results = textutils.unserialiseJSON(data)
    
    if not results or #results == 0 then
        print("Nenhum resultado encontrado!")
        return
    end
    
    print("Resultados:")
    print()
    
    for i = 1, math.min(10, #results) do
        print(i .. ". " .. results[i].title)
        print("   " .. results[i].channel)
        print()
    end
    
    print("Digite o numero para ver detalhes (0 = nova busca):")
    local choice = tonumber(read())
    
    if choice and choice > 0 and choice <= #results then
        local video = results[choice]
        term.clear()
        term.setCursorPos(1, 1)
        print("=== VIDEO SELECIONADO ===")
        print()
        print("Titulo: " .. video.title)
        print("Canal: " .. video.channel)
        print("ID: " .. video.id)
        print()
        print("Pressione qualquer tecla para voltar...")
        os.pullEvent("key")
    end
    
    if choice == 0 then
        return true
    end
end

while true do
    term.clear()
    term.setCursorPos(1, 1)
    print("=== YOUTUBE MUSIC PLAYER ===")
    print()
    print("Digite o nome da musica (Q para sair):")
    write("> ")
    
    local query = read()
    
    if query:lower() == "q" then
        term.clear()
        term.setCursorPos(1, 1)
        print("Ate logo!")
        break
    end
    
    if query ~= "" then
        searchYouTube(query)
    end
end
