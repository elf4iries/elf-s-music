--[[
    YouTube Music Player para Advanced Pocket Noise
]]

local basalt = require("basalt")

local main = basalt.createFrame()
main:setBackground(colors.black)

-- Título
local title = main:addLabel()
title:setText("ADVANCED POCKET NOISE")
title:setPosition(2, 2)
title:setForeground(colors.white)

-- Campo de URL
local urlLabel = main:addLabel()
urlLabel:setText("YouTube URL:")
urlLabel:setPosition(2, 4)
urlLabel:setForeground(colors.cyan)

local urlInput = main:addInput()
urlInput:setPosition(2, 5)
urlInput:setSize(35, 1)
urlInput:setBackground(colors.blue)
urlInput:setForeground(colors.white)

-- Botões
local playBtn = main:addButton()
playBtn:setText("PLAY")
playBtn:setPosition(2, 7)
playBtn:setSize(8, 3)
playBtn:setBackground(colors.green)
playBtn:setForeground(colors.black)

local stopBtn = main:addButton()
stopBtn:setText("STOP")
stopBtn:setPosition(12, 7)
stopBtn:setSize(8, 3)
stopBtn:setBackground(colors.red)
stopBtn:setForeground(colors.black)

-- Status
local status = main:addLabel()
status:setText("Ready")
status:setPosition(2, 11)
status:setForeground(colors.lime)

-- Função corrigida para tocar música
local function playMusic(url)
    if not url or url == "" then
        status:setText("Enter URL")
        return false
    end
    
    status:setText("Playing...")
    
    -- Usa o programa noise do Advanced Pocket Computer
    local result = shell.run("noise", url)
    
    if result then
        status:setText("Finished")
        return true
    else
        status:setText("Playback error")
        return false
    end
end

-- Função para parar
local function stopMusic()
    shell.run("noise", "stop")
    status:setText("Stopped")
end

-- Eventos dos botões - CORRIGIDO
playBtn:onClick(function()
    local url = urlInput:getText()  -- Corrigido: getText() em vez de getValue()
    playMusic(url)
end)

stopBtn:onClick(function()
    stopMusic()
end)

-- Instruções
local help = main:addLabel()
help:setText("Example: youtube.com/watch?v=...")
help:setPosition(2, 13)
help:setForeground(colors.gray)

local help2 = main:addLabel()
help2:setText("or youtu.be/...")
help2:setPosition(2, 14)
help:setForeground(colors.gray)

basalt.run()
