local basalt = require("basalt")

local main = basalt.createFrame()
main:setBackground(colors.black)

local title = main:addLabel()
title:setText("YOUTUBE MUSIC PLAYER")
title:setPosition(10, 3)
title:setForeground(colors.white)

local inputLabel = main:addLabel()
inputLabel:setText("Digite:")
inputLabel:setPosition(3, 6)
inputLabel:setForeground(colors.cyan)

local input = main:addInput()
input:setPosition(3, 7)
input:setSize(40, 3)
input:setBackground(colors.blue)
input:setForeground(colors.white)

local btn = main:addButton()
btn:setText("BUSCAR")
btn:setPosition(3, 11)
btn:setSize(12, 3)
btn:setBackground(colors.lightBlue)
btn:setForeground(colors.black)

local status = main:addLabel()
status:setText("")
status:setPosition(3, 15)
status:setForeground(colors.lime)

local results = main:addList()
results:setPosition(3, 17)
results:setSize(40, 8)
results:setBackground(colors.blue)
results:setForeground(colors.white)
results:setVisible(false)

btn:onClick(function()
    local query = input:getValue()
    if not query or query == "" then
        status:setText("Digite algo!")
        return
    end
    
    status:setText("Buscando...")
    results:setVisible(false)
    
    local url = "https://music.madefor.cc/search?q=" .. textutils.urlEncode(query)
    local response = http.get(url, nil, true)
    
    if not response then
        status:setText("Erro ao conectar!")
        return
    end
    
    local data = response.readAll()
    response.close()
    
    local items = textutils.unserialiseJSON(data)
    
    if not items or #items == 0 then
        status:setText("Sem resultados")
        return
    end
    
    status:setText("Encontrados: " .. #items)
    results:clear()
    
    for i = 1, math.min(8, #items) do
        results:addItem(items[i].title)
    end
    
    results:setVisible(true)
end)

results:onSelect(function(self)
    local idx = self:getItemIndex()
    status:setText("Selecionado item " .. idx)
end)

basalt.run()
