--[[
    YouTube Music Player (Basalt UI)
    Autor: elf4iries ğŸ§š
    CorreÃ§Ã£o: cria /basalt sÃ³ se necessÃ¡rio e baixa automaticamente o Basalt
    Tema: fada mÃ¡gica com interface azul
]]

-- Caminho da pasta Basalt
local basaltPath = "/basalt"

-- ğŸ”¹ Baixar automaticamente o Basalt se nÃ£o existir
if not fs.exists(basaltPath) then
    print("Baixando Basalt...")
    local basaltUrl = "https://basalt.madefor.cc/install.lua"
    local basaltInstaller = http.get(basaltUrl)

    if basaltInstaller then
        local installCode = basaltInstaller.readAll()
        basaltInstaller.close()
        local file = fs.open("/basalt_install.lua", "w")
        file.write(installCode)
        file.close()
        shell.run("/basalt_install.lua")
        fs.delete("/basalt_install.lua")
        print("Basalt instalado com sucesso!")
    else
        print("Erro: nÃ£o foi possÃ­vel baixar o Basalt.")
        return
    end
end

-- ğŸ”¹ Carregar Basalt com seguranÃ§a
local basalt = require("basalt")

-- Cria a janela principal
local main = basalt.createFrame()
main:setBackground(colors.black)

-- ğŸŒ™ Banner decorativo com fadinha ASCII
local banner = {
    "          âœ¨ğŸ§šâœ¨",
    "      â•”â•â˜†â•â˜†â•â˜†â•â˜†â•â˜†â•â•—",
    "        e l f 4 i r i e s",
    "      â•šâ•â˜†â•â˜†â•â˜†â•â˜†â•â˜†â•â•",
    "          âœ¨ğŸ§šâœ¨"
}

for i, line in ipairs(banner) do
    local label = main:addLabel()
    label:setText(line)
    label:setPosition(6, i)
    label:setForeground(colors.lightBlue)
end

-- TÃ­tulo
local title = main:addLabel()
title:setText("YOUTUBE MUSIC PLAYER")
title:setPosition(9, 8)
title:setForeground(colors.white)

-- Label do input
local inputLabel = main:addLabel()
inputLabel:setText("Digite:")
inputLabel:setPosition(3, 11)
inputLabel:setForeground(colors.cyan)

-- Campo de texto
local input = main:addInput()
input:setPosition(3, 12)
input:setSize(40, 3)
input:setBackground(colors.blue)
input:setForeground(colors.white)

-- BotÃ£o de busca
local btn = main:addButton()
btn:setText("BUSCAR")
btn:setPosition(3, 16)
btn:setSize(12, 3)
btn:setBackground(colors.lightBlue)
btn:setForeground(colors.black)

-- Status
local status = main:addLabel()
status:setText("")
status:setPosition(3, 20)
status:setForeground(colors.lime)

-- Lista de resultados
local results = main:addList()
results:setPosition(3, 22)
results:setSize(40, 8)
results:setBackground(colors.blue)
results:setForeground(colors.white)
results:setVisible(false)

-- FunÃ§Ã£o do botÃ£o
btn:onClick(function()
    local query = input:getValue()
    if not query or query == "" then
        status:setText("Digite algo!")
        return
    end
    
    status:setText("Buscando... âœ¨")
    results:setVisible(false)
    
    local url = "https://music.madefor.cc/search?q=" .. textutils.urlEncode(query)
    local response = http.get(url, nil, true)
    
    if not response then
        status:setText("Erro ao conectar! ğŸ§š")
        return
    end
    
    local data = response.readAll()
    response.close()
    
    local items = textutils.unserialiseJSON(data)
    
    if not items or #items == 0 then
        status:setText("Sem resultados ğŸ’«")
        return
    end
    
    status:setText("Encontrados: " .. #items .. " mÃºsicas ğŸµ")
    results:clear()
    
    for i = 1, math.min(8, #items) do
        results:addItem(items[i].title)
    end
    
    results:setVisible(true)
end)

-- Quando o usuÃ¡rio seleciona algo na lista
results:onSelect(function(self)
    local idx = self:getItemIndex()
    status:setText("âœ¨ Selecionado item " .. idx .. " ğŸ§š")
end)

-- Inicia a interface
basalt.run()
